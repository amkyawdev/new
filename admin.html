<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Burme AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/assets/css/styles.css">
</head>
<body class="min-h-screen">
    <div id="navbar"></div>
    <div id="sidebar"></div>
    
    <main class="container mx-auto px-4 py-8 mt-16">
        <!-- Admin Header -->
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold gradient-text">Admin Dashboard</h1>
            
            <div class="flex gap-2">
                <span class="px-3 py-1 bg-yellow-500 bg-opacity-20 text-yellow-500 rounded-full text-sm">
                    <i class="fas fa-shield-alt mr-1"></i>Admin Mode
                </span>
            </div>
        </div>
        
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="glass-effect p-6">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-secondary text-sm">Total Users</p>
                        <h3 class="text-3xl font-bold" id="total-users">-</h3>
                    </div>
                    <div class="w-12 h-12 rounded-full bg-blue-500 bg-opacity-20 flex items-center justify-center">
                        <i class="fas fa-users text-blue-500"></i>
                    </div>
                </div>
                <div class="mt-4 text-sm text-green-500">
                    <i class="fas fa-arrow-up mr-1"></i>+12% this week
                </div>
            </div>
            
            <div class="glass-effect p-6">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-secondary text-sm">Total Projects</p>
                        <h3 class="text-3xl font-bold" id="total-projects">-</h3>
                    </div>
                    <div class="w-12 h-12 rounded-full bg-purple-500 bg-opacity-20 flex items-center justify-center">
                        <i class="fas fa-code text-purple-500"></i>
                    </div>
                </div>
                <div class="mt-4 text-sm text-green-500">
                    <i class="fas fa-arrow-up mr-1"></i>+8% this week
                </div>
            </div>
            
            <div class="glass-effect p-6">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-secondary text-sm">Storage Used</p>
                        <h3 class="text-3xl font-bold" id="storage-used">-</h3>
                    </div>
                    <div class="w-12 h-12 rounded-full bg-green-500 bg-opacity-20 flex items-center justify-center">
                        <i class="fas fa-database text-green-500"></i>
                    </div>
                </div>
                <div class="mt-4 text-sm text-yellow-500">
                    <i class="fas fa-exclamation-triangle mr-1"></i>75% of limit
                </div>
            </div>
            
            <div class="glass-effect p-6">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-secondary text-sm">Active Sessions</p>
                        <h3 class="text-3xl font-bold" id="active-sessions">-</h3>
                    </div>
                    <div class="w-12 h-12 rounded-full bg-red-500 bg-opacity-20 flex items-center justify-center">
                        <i class="fas fa-globe text-red-500"></i>
                    </div>
                </div>
                <div class="mt-4 text-sm text-green-500">
                    <i class="fas fa-arrow-up mr-1"></i>+5% from yesterday
                </div>
            </div>
        </div>
        
        <!-- Charts Row -->
        <div class="grid lg:grid-cols-2 gap-6 mb-8">
            <div class="glass-effect p-6">
                <h3 class="text-lg font-bold mb-4">User Growth</h3>
                <canvas id="userGrowthChart"></canvas>
            </div>
            
            <div class="glass-effect p-6">
                <h3 class="text-lg font-bold mb-4">Projects by Type</h3>
                <canvas id="projectsChart"></canvas>
            </div>
        </div>
        
        <!-- Users Table -->
        <div class="glass-effect p-6 mb-8">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">Recent Users</h3>
                <button class="btn-primary text-sm px-4 py-2">
                    <i class="fas fa-download mr-2"></i>Export
                </button>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-glass-border">
                            <th class="text-left p-3 text-secondary">User</th>
                            <th class="text-left p-3 text-secondary">Email</th>
                            <th class="text-left p-3 text-secondary">Projects</th>
                            <th class="text-left p-3 text-secondary">Joined</th>
                            <th class="text-left p-3 text-secondary">Status</th>
                            <th class="text-left p-3 text-secondary">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="users-table-body">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- System Settings -->
        <div class="glass-effect p-6">
            <h3 class="text-lg font-bold mb-4">System Settings</h3>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-secondary mb-2">Maintenance Mode</label>
                    <div class="flex items-center gap-4">
                        <button class="btn-primary px-6 py-2 text-sm">Enable</button>
                        <span class="text-sm text-green-500">
                            <i class="fas fa-circle text-xs mr-1"></i>System Online
                        </span>
                    </div>
                </div>
                
                <div>
                    <label class="block text-secondary mb-2">Max File Size</label>
                    <select class="w-full p-2 rounded-lg bg-glass-bg border border-glass-border">
                        <option>10 MB</option>
                        <option>25 MB</option>
                        <option>50 MB</option>
                        <option>100 MB</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-secondary mb-2">Default Language</label>
                    <select class="w-full p-2 rounded-lg bg-glass-bg border border-glass-border">
                        <option>JavaScript</option>
                        <option>Python</option>
                        <option>HTML/CSS</option>
                        <option>TypeScript</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-secondary mb-2">AI Model Version</label>
                    <select class="w-full p-2 rounded-lg bg-glass-bg border border-glass-border">
                        <option>Gemini Pro 1.0</option>
                        <option>Gemini Pro 1.5 (Beta)</option>
                        <option>Gemini Ultra</option>
                    </select>
                </div>
            </div>
            
            <div class="mt-6 flex gap-4">
                <button class="btn-primary">Save Changes</button>
                <button class="btn-secondary">Reset to Default</button>
            </div>
        </div>
    </main>
    
    <div id="chatbot"></div>
    
    <script type="module">
        import { db } from '/config/firebase-config.js';
        import { collection, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // Load admin data
        async function loadAdminData() {
            // Get users count
            const usersSnapshot = await getDocs(collection(db, 'users'));
            document.getElementById('total-users').textContent = usersSnapshot.size;
            
            // Get projects count
            const projectsSnapshot = await getDocs(collection(db, 'projects'));
            document.getElementById('total-projects').textContent = projectsSnapshot.size;
            
            // Calculate storage used
            let totalStorage = 0;
            projectsSnapshot.forEach(doc => {
                const data = doc.data();
                if (data.files) {
                    Object.values(data.files).forEach(content => {
                        totalStorage += new Blob([content]).size;
                    });
                }
            });
            
            const storageMB = (totalStorage / (1024 * 1024)).toFixed(2);
            document.getElementById('storage-used').textContent = `${storageMB} MB`;
            
            // Mock active sessions
            document.getElementById('active-sessions').textContent = '1,234';
            
            // Load users table
            loadUsersTable();
            
            // Initialize charts
            initCharts();
        }
        
        async function loadUsersTable() {
            const usersQuery = query(collection(db, 'users'), orderBy('createdAt', 'desc'), limit(10));
            const usersSnapshot = await getDocs(usersQuery);
            
            const tbody = document.getElementById('users-table-body');
            tbody.innerHTML = '';
            
            usersSnapshot.forEach(doc => {
                const user = doc.data();
                const row = document.createElement('tr');
                row.className = 'border-b border-glass-border hover:bg-glass-bg';
                row.innerHTML = `
                    <td class="p-3">
                        <div class="flex items-center gap-2">
                            <img src="${user.photoURL || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(user.displayName || 'User')}" 
                                 class="w-8 h-8 rounded-full">
                            <span>${user.displayName || 'Unknown'}</span>
                        </div>
                    </td>
                    <td class="p-3">${user.email || 'No email'}</td>
                    <td class="p-3">${user.projectCount || 0}</td>
                    <td class="p-3">${user.createdAt ? new Date(user.createdAt).toLocaleDateString() : 'Unknown'}</td>
                    <td class="p-3">
                        <span class="px-2 py-1 bg-green-500 bg-opacity-20 text-green-500 rounded-full text-xs">
                            Active
                        </span>
                    </td>
                    <td class="p-3">
                        <button class="text-accent-primary hover:text-accent-secondary mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-500 hover:text-red-600">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function initCharts() {
            // User Growth Chart
            const userCtx = document.getElementById('userGrowthChart').getContext('2d');
            new Chart(userCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'New Users',
                        data: [120, 150, 180, 220, 280, 350],
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: { color: '#a0a0c0' }
                        }
                    },
                    scales: {
                        y: { grid: { color: 'rgba(255,255,255,0.1)' } },
                        x: { grid: { color: 'rgba(255,255,255,0.1)' } }
                    }
                }
            });
            
            // Projects Chart
            const projectsCtx = document.getElementById('projectsChart').getContext('2d');
            new Chart(projectsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Web Apps', 'Mobile Apps', 'APIs', 'Libraries'],
                    datasets: [{
                        data: [450, 230, 180, 120],
                        backgroundColor: ['#4f46e5', '#7c3aed', '#2563eb', '#0891b2']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: { color: '#a0a0c0' }
                        }
                    }
                }
            });
        }
        
        // Check if user is admin
        import { auth } from '/config/firebase-config.js';
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Check if user has admin role (you need to implement this in Firebase)
                const isAdmin = true; // Replace with actual check
                
                if (!isAdmin) {
                    window.location.href = '/dashboard.html';
                } else {
                    loadAdminData();
                }
            } else {
                window.location.href = '/login.html';
            }
        });
    </script>
</body>
                  </html>
